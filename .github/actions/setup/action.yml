name: 'Setup Environment and Resources'
description: 'Checkout repository, setup environment and caching'
outputs:
  cache-dependencies-hit:
    description: "Use dependencies cache"
    value: ${{ steps.cache-npm.outputs.cache-hit }}
  cache-build-hit:
    description: "Use build output scripts cache"
    value: ${{ steps.cache-build.outputs.cache-hit }}
runs:
  using: "composite"
  steps:
    - name: Check out repository code
      uses: actions/checkout@v2
      with:
        # Number of commits to fetch. 0 indicates all history for all branches and tags.
        # Pulls all commits (needed for Lerna)
        fetch-depth: 0

    - name: Setup Node.js
      uses: actions/setup-node@v2
      with:
        node-version: 15.x

    - name: Setup caching dependencies
      uses: actions/cache@v2
      id: cache-npm
      with:
        path: |
          node_modules
          */*/node_modules
        key: ${{ runner.os }}-npm-${{ hashFiles('**/package-lock.json') }}
        restore-keys: ${{ runner.os }}-npm-${{ hashFiles('**/package-lock.json') }}

    - name: Setup caching build
      uses: actions/cache@v2
      id: cache-build
      with:
        path: |
          packages/*/lib
          packages/*-theme/**/*.js
          packages/*-theme/**/*.css
        key: ${{ runner.os }}-build-${{ github.sha }}
        restore-keys: ${{ runner.os }}-build-${{ github.sha }}
