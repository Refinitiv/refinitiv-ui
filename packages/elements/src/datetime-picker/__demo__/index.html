<!DOCTYPE html>
<html lang="en-GB">
  <head>
    <meta charset="utf-8" />
    <title>Datetime Picker</title>
    <style type="text/css">
      ef-datetime-picker[range][timepicker] {
        width: 400px;
      }
      demo-block {
        width: 1400px;
      }
      ef-text-field,
      ef-select {
        width: 300px;
      }
      .custom-cell {
        background-color: #4e7349;
        border: 1px solid #fb8a03;
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .custom-cell:hover {
        background-color: #00c389;
        border: 1px solid #00c389;
      }
      .custom-cell.active {
        background-color: #0f1e8a;
      }
      .custom-cell.range {
        background-color: #1fa90a;
      }
      .custom-cell.now {
        background-color: rgb(246, 233, 175);
      }
      .custom-cell.now:hover {
        background-color: rgb(244, 206, 39);
      }
      .custom-cell.disabled {
        background-color: rgb(223, 41, 41);
      }
    </style>
  </head>
  <body>
    <script type="module">
      import '@refinitiv-ui/elements/button';
      import '@refinitiv-ui/elements/checkbox';
      import '@refinitiv-ui/elements/datetime-picker';
      import '@refinitiv-ui/elements/item';
      import '@refinitiv-ui/elements/radio-button';
      import '@refinitiv-ui/elements/select';

      import '@refinitiv-ui/demo-block';
      import '@refinitiv-ui/demo-block/demo.css';

      // Dynamic import theme files from search params of the URL
      // Ex. http://localhost:3000?theme=halo&varint=dark will load halo-theme/dark
      const url = new URL(window.location);
      const theme = url.searchParams.get('theme') || 'halo';
      const variant = url.searchParams.get('variant') || 'light';

      if (!window.location.search) {
        url.searchParams.set('theme', theme);
        url.searchParams.append('variant', variant);
        window.location.search = url.searchParams.toString();
      }

      import(`../../../../../node_modules/@refinitiv-ui/${theme}-theme/${variant}/css/native-elements.css`);
      import(`../../../lib/datetime-picker/themes/${theme}/${variant}/index.js`);
      import(`../../../lib/button/themes/${theme}/${variant}/index.js`);
      import(`../../../lib/checkbox/themes/${theme}/${variant}/index.js`);
      import(`../../../lib/select/themes/${theme}/${variant}/index.js`);
      import(`../../../lib/item/themes/${theme}/${variant}/index.js`);
      import(`../../../lib/radio-button/themes/${theme}/${variant}/index.js`);
    </script>

    <script type="module">
      const duplexDatetimePicker = document.getElementById('duplex-datetime-picker');
      const singleDatetimePicker = document.getElementById('single-datetime-picker');

      const beforeCellRenderHandlerSingle = (event) => {
        const sourceCalendar = event.target;
        const { cell } = event.detail;
        const targetCell = sourceCalendar.querySelector(`[slot="${cell.value}"]`);
        if (!targetCell) {
          return;
        }
        const classList = targetCell.classList;
        //  show default text when is there no content
        if (!targetCell.innerHTML.trim()) {
          targetCell.textContent = cell.text;
        }
        //  update style with class based on cell model
        if (cell.selected || cell.rangeFrom || cell.rangeTo) {
          classList.add('selected-range-boundary');
        } else {
          classList.remove('selected-range-boundary');
        }
        // style update with dynamic cell model key
        const keys = ['range', 'disabled', 'idle', 'now', 'active'];
        for (const key of keys) {
          cell[key] ? classList.add(key) : classList.remove(key);
        }
      };

      const beforeCellRenderHandlerDuplex = (event) => {
        const sourceCalendar = event.target;
        const { cell } = event.detail;
        const id = event.detail.calendarId === 'calendar-to' ? 'to-' : 'from-';
        const targetCell = sourceCalendar.querySelector(`[slot="${id}${cell.value}"]`);
        if (!targetCell) {
          return;
        }
        const classList = targetCell.classList;
        //  show default text when is there no content
        if (!targetCell.innerHTML.trim()) {
          targetCell.textContent = cell.text;
        }
        //  update style with class based on cell model
        if (cell.selected || cell.rangeFrom || cell.rangeTo) {
          classList.add('selected-range-boundary');
        } else {
          classList.remove('selected-range-boundary');
        }
        // style update with dynamic cell model key
        const keys = ['range', 'disabled', 'idle', 'now', 'active'];
        for (const key of keys) {
          cell[key] ? classList.add(key) : classList.remove(key);
        }
      };

      duplexDatetimePicker.addEventListener('before-cell-render', beforeCellRenderHandlerDuplex);
      singleDatetimePicker.addEventListener('before-cell-render', beforeCellRenderHandlerSingle);
    </script>
    <demo-block header="single">
      <ef-datetime-picker id="single-datetime-picker">
        <div class="custom-cell" slot="2023-10-10">10</div>
        <div class="custom-cell" slot="2023-10-11">11</div>
        <div class="custom-cell" slot="2023-10">Oct</div>
        <div class="custom-cell" slot="2023">2023</div>
      </ef-datetime-picker>
    </demo-block>
    <demo-block header="duplex">
      <ef-datetime-picker id="duplex-datetime-picker" duplex="split">
        <div class="custom-cell" slot="from-2023-10-10">10</div>
        <div class="custom-cell" slot="from-2023-10-11">11</div>
        <div class="custom-cell" slot="from-2023-10">Oct</div>
        <div class="custom-cell" slot="from-2023">2023</div>
        <div class="custom-cell" slot="to-2023-11-10">10</div>
        <div class="custom-cell" slot="to-2023-11-11">11</div>
        <div class="custom-cell" slot="to-2023-11">Nov</div>
        <div class="custom-cell" slot="to-2023">2023</div>
      </ef-datetime-picker>
    </demo-block>
  </body>
</html>
