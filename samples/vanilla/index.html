<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Webpack sample</title>
  </head>
  <body>
    <script src="./dist/index.js"></script>
    <div class="container">
      <ef-header level="2" class="toolbar">
        <div class="toolbar-items" slot="right">
          Theme:
          <ef-toggle
            class="theme-switcher"
            label="light"
            checked-label="dark"
          >
          </ef-toggle>
          <ef-button id="profile-button" icon="profile"></ef-button>
        </div>
      </ef-header>
      <div class="content-container">
        <ef-tab-bar vertical>
          <ef-tab label="Line Chart" icon="line-chart"></ef-tab>
          <ef-tab label="Area Chart" icon="chart-area"></ef-tab>
          <ef-tab label="Bar Chart" icon="chart-bar"></ef-tab>
          <ef-tab label="Candlestick Chart" icon="candle-chart"></ef-tab>
          <ef-tab label="Volume Chart" icon="chart-line-bar"></ef-tab>
        </ef-tab-bar>
        <div class="chart-container">
          <ef-interactive-chart></ef-interactive-chart>
        </div>
      </div>
      <ef-dialog header="Edit Profile">
        <div class="form-input">
          <label>Name *</label>
          <ef-text-field
            id="nameInput"
            placeholder="Name"
          >
          </ef-text-field>
        </div>
        <div class="form-input">
          <label>Gender</label>
          <div id="radio-group">
            <ef-radio-button name="gender">Male</ef-radio-button>
            <ef-radio-button name="gender">Female</ef-radio-button>
            <ef-radio-button name="gender">Prefer not to say</ef-radio-button>
          </div>
        </div>
        <div class="form-input">
          <label>Date of Birth</label>
          <ef-datetime-picker></ef-datetime-picker>
        </div>
        <div class="form-input">
          <label>Address</label>
          <textarea autoCorrect="off" autoComplete="off" autoCapitalize="off" rows="4" cols="50"></textarea>
        </div>
        <div class="form-input">
          <label>Email *</label>
          <ef-email-field
            placeholder="user@refinitiv.com">
          </ef-email-field>
        </div>
        <div class="form-input">
          <label>Job Function</label>
          <div id="job-panel" class="job-panel" role="button">
            <div id="job-display"></div>
            <ef-icon icon="arrow-down-fill"></ef-icon>
          </div>
          <ef-overlay-menu id="menu">
            <ef-item for="saletrade">Sales & Trading</ef-item>
            <ef-item for="maandcr">M&A and Capital Raising</ef-item>
            <ef-item for="research">Research / Analysis</ef-item>
            </ef-overlay-menu>
          <ef-overlay-menu id="saletrade">
            <ef-item value="Trader">Trader*</ef-item>
            <ef-item value="Sales">Sales*</ef-item>
            <ef-item value="Broker">Broker*</ef-item>
          </ef-overlay-menu>
          <ef-overlay-menu id="maandcr">
            <ef-item value="ECM / DCM - Origination / Syndication">ECM / DCM - Origination / Syndication*</ef-item>
            <ef-item value="M&A / Coverage Banker Senior">M&A / Coverage Banker Senior</ef-item>
            <ef-item value="M&A / Coverage Banker Junior">M&A / Coverage Banker Junior</ef-item>
            <ef-item value="Private Equity / Venture Capital">Private Equity / Venture Capital</ef-item>
            <ef-item value="Investment Banking Business Manager">Investment Banking Business Manager</ef-item>
          </ef-overlay-menu>
          <ef-overlay-menu id="research">
            <ef-item value="Research / Market Analyst">Research / Market Analyst*</ef-item>
            <ef-item value="Quant">Quant</ef-item>
            <ef-item value="Economist">Economist</ef-item>
            <ef-item value="Investment Strategist">Investment Strategist</ef-item>
          </ef-overlay-menu>
        </div>
        <div class="form-input">
          <ef-checkbox>I want to receive news and updates via email</ef-checkbox> 
        </div>
        <div class="form-footer" slot="footer">
          <ef-button id="confirm-button" cta>Confirm</ef-button>
          <ef-button id="cancel-button">Cancel</ef-button>
        </div>
      </ef-dialog>
    </div>
    
    <script>
      const defaultTheme = document.documentElement.getAttribute('theme');
      const chartType = sessionStorage.getItem('chartType') || 'line';
      
      // initial style
      const head = document.getElementsByTagName('HEAD')[0];
      const link = document.createElement('link');
      link.rel = 'stylesheet';
      link.href = `./dist/styles/${defaultTheme}.css`;
      head.appendChild(link);

      window.onload = function () {
        const toggle = document.querySelector('ef-toggle');
        const tabs = document.querySelectorAll('ef-tab');
        const profileButton = document.querySelector('#profile-button');
        const dialog = document.querySelector('ef-dialog');
        const textField = document.querySelector('ef-text-field');
        const radioGroup = document.querySelector('#radio-group');
        const datetimePicker = document.querySelector('ef-datetime-picker');
        const textArea = document.querySelector('textarea');
        const emailField = document.querySelector('ef-email-field');
        const menu = document.querySelector('ef-overlay-menu');
        const jobPanel = document.querySelector('#job-panel');
        const jobDisplay = document.querySelector('#job-display');
        const checkbox = document.querySelector('ef-checkbox');
        const confirmButton = document.querySelector('#confirm-button');
        const cancelButton = document.querySelector('#cancel-button');
        const chart = document.querySelector('ef-interactive-chart');

        const data = [
          {
            'time': Date.parse('2019-04-10T08:40:10') / 1000,
            'open': 141.77,
            'high': 170.39,
            'low': 120.25,
            'close': 145.72,
            'value': 145.32
          },
          {
            'time': Date.parse('2019-04-10T09:40:10') / 1000,
            'open': 145.72,
            'high': 147.99,
            'low': 100.11,
            'close': 108.19,
            'value': 124.05000000000001
          },
          {
            'time': Date.parse('2019-04-10T10:40:10') / 1000,
            'open': 108.19,
            'high': 118.43,
            'low': 74.22,
            'close': 75.16,
            'value': 96.325
          },
          {
            'time': Date.parse('2019-04-10T11:40:10') / 1000,
            'open': 75.16,
            'high': 82.84,
            'low': 36.16,
            'close': 45.72,
            'value': 59.5
          },
          {
            'time': Date.parse('2019-04-10T12:40:10') / 1000,
            'open': 45.72,
            'high': 120.12,
            'low': 44.1,
            'close': 90.5,
            'value': 82.11
          },
          {
            'time': Date.parse('2019-04-10T13:40:10') / 1000,
            'open': 90.5,
            'high': 95.89,
            'low': 75.58,
            'close': 105.55,
            'value': 85.735
          }
        ];
        
        // chart section
        // initial chart config
        chart.config = {
          options: {
            timeScale: {
              timeVisible: true,
              secondsVisible: true
            }
          },
          series: [{
            symbol: 'Price',
            type: chartType,
            data: data
          }]
        };

        tabs.forEach((tab) => {
          const type = tab.label.substring(0, tab.label.indexOf(' ')).toLowerCase();
          if (chartType === type) {
            tab.active = true;
          }
          tab.addEventListener('tap', function (e) {
            resetActive();
            e.target.active = true;
            const chartConfig = Object.assign({}, chart.config);
            chartConfig.series[0].type = type;
            chart.config = chartConfig;

            sessionStorage.setItem('chartType', type);
          });
        });

        // form section
        let formData = { isReceiveMail: true };
        const isSubmitDisabled = (data) => !data.name || !data.email ? true : undefined;
        confirmButton.disabled = isSubmitDisabled(formData);
        menu.positionTarget = jobPanel;
        
        const handleChangeFormData = (data) => {
          formData = Object.assign(formData, data);
          confirmButton.disabled = isSubmitDisabled(formData);
        };

        const toggleDialog = () => {
          dialog.opened = !dialog.opened;
        };

        profileButton.addEventListener('tap', (e) => toggleDialog());
        textField.addEventListener('value-changed', (e) => handleChangeFormData({ name: e.detail.value }));
        radioGroup.addEventListener('checked-changed', (e) => handleChangeFormData({ gender: e.target.textContent }));
        datetimePicker.addEventListener('value-changed', (e) => handleChangeFormData({ date: e.detail.value }));
        textArea.addEventListener('change', (e) => handleChangeFormData({ address: e.target.value }));
        emailField.addEventListener('value-changed', (e) => handleChangeFormData({ email: e.detail.value }));
        menu.parentElement.addEventListener('item-trigger', (e) => handleItemTrigger(e.detail.value));
        checkbox.checked = true;
        checkbox.addEventListener('checked-changed', (e) => handleChangeFormData({ isReceiveMail: e.target.checked }));
        confirmButton.addEventListener('tap', (e) => handleClickConfirm());
        cancelButton.addEventListener('tap', (e) => toggleDialog());

        jobPanel.addEventListener('tap', () => {
          menu.opened = true;
        });

        const handleItemTrigger = (value) => {
          if(value) {
            handleChangeFormData({ job: value });
            jobDisplay.innerHTML = value;
            menu.opened = false;
          }
        };

        const handleClickConfirm = () => {
          // eslint-disable-next-line no-console
          console.log('data =', JSON.stringify(formData, null, 2));
          toggleDialog();
        };

        // theme switching section
        if (defaultTheme === 'dark') {
          toggle.checked = true;
        }
        toggle.addEventListener('tap', function (e) {
          const theme = e.target.checked ? 'dark' : 'light';
          window.location.reload();
          sessionStorage.setItem('elf-theme', theme);
        });
      };
    </script>
  </body>
</html>